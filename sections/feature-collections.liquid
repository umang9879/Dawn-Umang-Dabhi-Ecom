{% comment %}
  Section: cst-collection-slider (Swiper-based)
  - Title block (only one)
  - Card blocks (collection selection, custom image option, layout 1 or 2)
  - Navigation block (only one)
  - Fully namespaced with #section-{{ section.id }} and .cst- prefix
{% endcomment %}

<section id="section-{{ section.id }}" class="cst-section" aria-label="{{ section.settings.accessibility_label }}">
  <!-- Swiper Styles -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
  >

  <style>
    #section-{{ section.id }} {
      background-color: {{ section.settings.bg_color }};
      padding: {{ section.settings.padding_top_desktop }}px {{ section.settings.padding_right_desktop }}px {{ section.settings.padding_bottom_desktop }}px {{ section.settings.padding_left_desktop }}px;
    }
    @media (max-width: 767px) {
      #section-{{ section.id }} {
        padding: {{ section.settings.padding_top_mobile }}px {{ section.settings.padding_right_mobile }}px {{ section.settings.padding_bottom_mobile }}px {{ section.settings.padding_left_mobile }}px;
      }
    }

    #section-{{ section.id }} .cst-title {
      color: #30309F;
      text-transform: uppercase;
      text-align: center;
      font-size: 32px;
      margin-bottom: {{ section.settings.gap_desktop }}px;
      font-weight: 600;
    }
    @media (max-width: 767px) {
      #section-{{ section.id }} .cst-title {
        font-size: 24px;
        margin-bottom: {{ section.settings.gap_mobile }}px;
      }
    }

    #section-{{ section.id }} .swiper {
      overflow: visible;
    }

    #section-{{ section.id }} .swiper-slide {
      flex-shrink: 0;
      display: flex;
      justify-content: center;
    }

    /* Layout 1 */
    #section-{{ section.id }} .cst-card--layout1 {
      width: 335px;
      height: 450px;
      border-radius: 6px;
      overflow: hidden;
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      position: relative;
    }

    #section-{{ section.id }} .cst-card--layout1::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.5), rgba(0,0,0,0));
    }

    #section-{{ section.id }} .cst-card--layout1 .cst-card-inner {
      position: relative;
      z-index: 2;
      padding: 24px;
    }

    #section-{{ section.id }} .cst-card--layout1 .cst-cta {
      border: 1px solid #fff;
      background: transparent;
      color: #fff;
      padding: 10px 18px;
      text-transform: uppercase;
      font-weight: 600;
      border-radius: 3px;
      text-decoration: none;
    }

    /* Layout 2 */
    #section-{{ section.id }} .cst-card--layout2 {
      width: 96px;
      text-align: center;
    }
    #section-{{ section.id }} .cst-card--layout2 .cst-thumb {
      width: 96px;
      height: 96px;
      border-radius: 6px;
      background-size: cover;
      background-position: center;
      margin-bottom: 8px;
    }
    #section-{{ section.id }} .cst-card--layout2 .cst-title-small {
      font-size: 13px;
      color: #222;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Navigation */
    #section-{{ section.id }} .cst-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: {{ section.settings.nav_gap_desktop }}px;
      margin-top: {{ section.settings.gap_desktop }}px;
    }
    @media (max-width: 767px) {
      #section-{{ section.id }} .cst-nav {
        gap: {{ section.settings.nav_gap_mobile }}px;
        margin-top: {{ section.settings.gap_mobile }}px;
      }
    }

    #section-{{ section.id }} .cst-arrow {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: 1px solid transparent;
      cursor: pointer;
    }

    #section-{{ section.id }} .cst-arrow svg {
      stroke: {{ section.settings.nav_active_color }};
    }

    #section-{{ section.id }} .cst-link-btn {
      padding: 12px 20px;
      font-weight: 600;
      text-transform: uppercase;
      border-radius: 2px;
      text-decoration: none;
      font-size: 13px;
    }

    #section-{{ section.id }} .cst-link-btn.outlined {
      border: 1px solid #30309F;
      color: #30309F;
      background: transparent;
    }

    #section-{{ section.id }} .cst-link-btn.filled {
      border: none;
      background: #30309F;
      color: #fff;
    }

  </style>

  <div class="cst-inner">
    {% assign title_block = section.blocks | where: 'type', 'title' | first %}
    {% if title_block %}
      <h2 class="cst-title">{{ title_block.settings.title_text }}</h2>
    {% endif %}

    <div class="cst-slider-wrap swiper" id="cst-swiper-{{ section.id }}">
      <div class="swiper-wrapper">
        {% for block in section.blocks %}
          {% if block.type == 'card' %}
            {% assign use_custom = block.settings.use_custom_image %}
            {% assign card_img = '' %}
            {% if use_custom and block.settings.custom_image != blank %}
              {% assign card_img = block.settings.custom_image | img_url: '800x' %}
            {% elsif block.settings.collection != blank %}
              {% assign coll = collections[block.settings.collection] %}
              {% if coll.image %}
                {% assign card_img = coll.image | img_url: '800x' %}
              {% endif %}
            {% endif %}

            {% if block.settings.layout == 'layout1' %}
              <div class="swiper-slide">
                <div class="cst-card cst-card--layout1" style="background-image:url('{{ card_img }}')">
                  <div class="cst-card-inner">
                    {% if block.settings.collection != blank %}
                      <a href="{{ collections[block.settings.collection].url }}" class="cst-cta">
                        {{ collections[block.settings.collection].title }}
                      </a>
                    {% else %}
                      <a href="#" class="cst-cta">{{ block.settings.custom_cta_label }}</a>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% else %}
              <div class="swiper-slide">
                <div class="cst-card cst-card--layout2">
                  <a href="{% if block.settings.collection != blank %}{{ collections[block.settings.collection].url }}{% else %}#{% endif %}">
                    <div class="cst-thumb" style="background-image:url('{{ card_img }}')"></div>
                  </a>
                  <div class="cst-title-small">
                    {% if block.settings.collection != blank %}
                      {{ collections[block.settings.collection].title }}
                    {% else %}
                      {{ block.settings.custom_title }}
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </div>

    {% assign nav_block = section.blocks | where: 'type', 'navigation' | first %}
    {% if nav_block %}
      <div class="cst-nav">
        <button class="cst-arrow cst-prev-{{ section.id }}">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#30309F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>

        <a href="{{ nav_block.settings.link_url }}" class="cst-link-btn {% if nav_block.settings.link_style == 'outlined' %}outlined{% else %}filled{% endif %}">
          {{ nav_block.settings.link_label }}
        </a>

        <button class="cst-arrow cst-next-{{ section.id }}">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#30309F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    {% endif %}
  </div>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const swiper{{ section.id }} = new Swiper('#cst-swiper-{{ section.id }}', {
        slidesPerView: 'auto',
        spaceBetween: {{ section.settings.slides_gap }},
        grabCursor: true,
        navigation: {
          nextEl: '.cst-next-{{ section.id }}',
          prevEl: '.cst-prev-{{ section.id }}',
        },
        breakpoints: {
          320: { slidesPerView: 2 },
          640: { slidesPerView: 3 },
          1024: { slidesPerView: 4 }
        }
      });
    });
  </script>

  {% schema %}
  {
    "name": "CST Collections Slider",
    "settings": [
      { "type": "color", "id": "bg_color", "label": "Background color", "default": "#F5F5F5" },
      { "type": "range", "id": "slides_gap", "label": "Gap between slides", "min": 0, "max": 60, "step": 1, "default": 8 },
      { "type": "range", "id": "padding_top_desktop", "label": "Padding top desktop", "min": 0, "max": 100, "default": 96 },
      { "type": "range", "id": "padding_bottom_desktop", "label": "Padding bottom desktop", "min": 0, "max": 100, "default": 96 },
      { "type": "range", "id": "padding_left_desktop", "label": "Padding left desktop", "min": 0, "max": 100, "default": 64 },
      { "type": "range", "id": "padding_right_desktop", "label": "Padding right desktop", "min": 0, "max": 100, "default": 64 },
      { "type": "range", "id": "padding_top_mobile", "label": "Padding top mobile", "min": 0, "max": 100, "default": 56 },
      { "type": "range", "id": "padding_bottom_mobile", "label": "Padding bottom mobile", "min": 0, "max": 100, "default": 56 },
      { "type": "range", "id": "padding_left_mobile", "label": "Padding left mobile", "min": 0, "max": 100, "default": 16 },
      { "type": "range", "id": "padding_right_mobile", "label": "Padding right mobile", "min": 0, "max": 100, "default": 16 },
      { "type": "range", "id": "gap_desktop", "label": "Gap between title / nav desktop", "min": 0, "max": 100, "default": 56 },
      { "type": "range", "id": "gap_mobile", "label": "Gap between title / nav mobile", "min": 0, "max": 100, "default": 40 },
      { "type": "color", "id": "nav_active_color", "label": "Arrow active color", "default": "#30309F" },
      { "type": "range", "id": "nav_gap_desktop", "label": "Nav gap desktop", "min": 0, "max": 100, "default": 40 },
      { "type": "range", "id": "nav_gap_mobile", "label": "Nav gap mobile", "min": 0, "max": 60, "default": 8 }
    ],
    "blocks": [
      {
        "type": "title",
        "name": "Title",
        "settings": [
          { "type": "text", "id": "title_text", "label": "Title text", "default": "DOORS FOR EVERY HOME" }
        ]
      },
      {
        "type": "card",
        "name": "Card",
        "settings": [
          { "type": "collection", "id": "collection", "label": "Select collection" },
          { "type": "checkbox", "id": "use_custom_image", "label": "Use custom image", "default": false },
          { "type": "image_picker", "id": "custom_image", "label": "Custom image" },
          { "type": "select", "id": "layout", "label": "Card layout", "options": [
              { "value": "layout1", "label": "Layout 1 (big card)" },
              { "value": "layout2", "label": "Layout 2 (small card)" }
            ], "default": "layout1"
          },
          { "type": "range", "id": "card_padding", "label": "Card padding (px)", "min": 0, "max": 60, "default": 24 },
          { "type": "text", "id": "custom_cta_label", "label": "CTA label", "default": "Find out" },
          { "type": "text", "id": "custom_title", "label": "Custom title (for layout 2)", "default": "Collection" }
        ]
      },
      {
        "type": "navigation",
        "name": "Navigation",
        "settings": [
          { "type": "text", "id": "link_label", "label": "Link label", "default": "FIND THE PERFECT DOOR" },
          { "type": "url", "id": "link_url", "label": "Link URL"},
          { "type": "select", "id": "link_style", "label": "Button style", "options": [
              { "value": "outlined", "label": "Outlined" },
              { "value": "filled", "label": "Filled" }
            ], "default": "outlined"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "CST Collection Slider",
        "category": "Collection",
        "blocks": [
          { "type": "title" },
          { "type": "card" },
          { "type": "card" },
          { "type": "card" },
          { "type": "navigation" }
        ]
      }
    ]
  }
  {% endschema %}
</section>
